<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1a1a1a;
            color: #00ff00;
        }
        .box {
            background: #2a2a2a;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
        }
        .status { color: #ffaa00; }
        .error { color: #ff0000; }
        .success { color: #00ff00; }
        h1 { color: #00ff00; text-align: center; }
        pre { 
            background: #000; 
            padding: 10px; 
            overflow: auto; 
            font-size: 11px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üîß TELEGRAM DIAGNOSTIC TEST</h1>
    
    <div class="box">
        <h2>1. Page Loaded</h2>
        <p class="success">‚úÖ HTML is rendering!</p>
        <p>Time: <span id="time"></span></p>
    </div>

    <div class="box">
        <h2>2. Telegram WebApp Status</h2>
        <p id="telegram-status" class="status">‚è≥ Checking...</p>
    </div>

    <div class="box">
        <h2>3. Init Data</h2>
        <pre id="init-data">Loading...</pre>
    </div>

    <div class="box">
        <h2>4. User Info</h2>
        <pre id="user-info">Loading...</pre>
    </div>

    <div class="box">
        <h2>5. Screen Info</h2>
        <pre id="screen-info">Loading...</pre>
    </div>

    <div class="box">
        <h2>6. API Test</h2>
        <p id="api-test" class="status">‚è≥ Testing...</p>
    </div>

    <script>
        // Update time
        document.getElementById('time').textContent = new Date().toLocaleTimeString();

        // Check Telegram
        setTimeout(() => {
            const tg = window.Telegram?.WebApp;
            const statusEl = document.getElementById('telegram-status');
            
            if (!tg) {
                statusEl.innerHTML = '<span class="error">‚ùå window.Telegram.WebApp NOT FOUND!</span>';
            } else {
                statusEl.innerHTML = '<span class="success">‚úÖ Telegram WebApp loaded!</span>';
                tg.ready();
                tg.expand();
            }

            // Init data
            const initDataEl = document.getElementById('init-data');
            if (tg?.initData) {
                initDataEl.textContent = `Length: ${tg.initData.length}\n\nData: ${tg.initData.substring(0, 100)}...`;
            } else {
                initDataEl.innerHTML = '<span class="error">‚ùå NO INIT DATA!</span>';
            }

            // User info
            const userInfoEl = document.getElementById('user-info');
            if (tg?.initDataUnsafe?.user) {
                userInfoEl.textContent = JSON.stringify(tg.initDataUnsafe.user, null, 2);
            } else {
                userInfoEl.innerHTML = '<span class="error">‚ùå NO USER DATA!</span>';
            }

            // Screen info
            document.getElementById('screen-info').textContent = 
                `Window: ${window.innerWidth}x${window.innerHeight}\n` +
                `Screen: ${screen.width}x${screen.height}\n` +
                `Device Pixel Ratio: ${window.devicePixelRatio}\n` +
                `User Agent: ${navigator.userAgent}`;

            // API test
            fetch('/api/equipment-types')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('api-test').innerHTML = 
                        `<span class="success">‚úÖ API Working! Got ${data.length} equipment items</span>`;
                })
                .catch(err => {
                    document.getElementById('api-test').innerHTML = 
                        `<span class="error">‚ùå API Failed: ${err.message}</span>`;
                });
        }, 500);
    </script>
</body>
</html>

