import{j as e}from"./ui-DDb1Cthj.js";import{r as h}from"./vendor-CbTYwD9p.js";import{u as f,a as B}from"./query-DJEuKXE5.js";import{u as A,i as F,C as x,B as y,P as M,a as g,f as P,q as v,j as D}from"./index-DP8xWL5x.js";import{I as C}from"./input-CRHmV_Qe.js";import{_ as w,c as p,U as K,G as Y,a1 as _,a2 as z,a3 as H,l as Q}from"./icons-DpVlej8W.js";import{a as G}from"./utils-BkWO3WEY.js";import"./router-i_uqa6-9.js";import"./tonconnect-BAw8c48p.js";import"./ton-BfqU8ldO.js";function ae(){const[n,k]=h.useState(null),[i,b]=h.useState(""),{toast:l}=A();h.useEffect(()=>{F().then(k).catch(r=>{console.error("Failed to initialize user:",r)})},[]);const{data:t,isLoading:S}=f({queryKey:["/api/user",n],enabled:!!n}),{data:s=[],isLoading:o}=f({queryKey:["/api/user",n,"referrals"],enabled:!!n}),{data:j=[],isLoading:R}=f({queryKey:["/api/leaderboard/referrals"],queryFn:async()=>{const r=D();if(!r)throw new Error("Not authenticated");const a=await fetch("/api/leaderboard/referrals?limit=25",{headers:{"X-Telegram-Init-Data":r}});if(!a.ok)throw new Error("Failed to fetch leaderboard");return a.json()}}),c=B({mutationFn:async r=>(await P("POST",`/api/user/${n}/referrals/apply`,{referralCode:r})).json(),onSuccess:r=>{l({title:"Referral Code Applied!",description:`You earned ${r.userBonus} CS! Your referrer earned ${r.referrerBonus} CS.`}),b(""),v.invalidateQueries({queryKey:["/api/user",n]}),v.invalidateQueries({queryKey:["/api/user",n,"referrals"]})},onError:r=>{l({title:"Error",description:r.message||"Failed to apply referral code",variant:"destructive"})}}),$=()=>{if(!(t!=null&&t.referralCode))return;const a=`https://t.me/cryptohackerheist_bot?start=${t.referralCode}`;navigator.clipboard.writeText(a),l({title:"Copied!",description:"Referral link copied to clipboard"})},L=()=>{if(!(t!=null&&t.referralCode))return;const a=`https://t.me/cryptohackerheist_bot?start=${t.referralCode}`,u=`https://t.me/share/url?url=${encodeURIComponent(a)}&text=${encodeURIComponent("Join me on Crypto Hacker Heist and start mining crypto! Use my referral link to get bonus CS:")}`;window.open(u,"_blank")},U=r=>{if(r.preventDefault(),!i.trim()){l({title:"Error",description:"Please enter a referral code",variant:"destructive"});return}c.mutate(i.trim())},E=s.reduce((r,a)=>r+a.bonusEarned,0),T=t&&!t.referredBy,N=[{count:5,reward:"5,000 CS",icon:w,reached:s.length>=5},{count:10,reward:"15,000 CS",icon:w,reached:s.length>=10},{count:25,reward:"50,000 CS",icon:p,reached:s.length>=25},{count:50,reward:"150,000 CS",icon:p,reached:s.length>=50},{count:100,reward:"500,000 CS",icon:p,reached:s.length>=100}],d=N.find(r=>!r.reached),I=d?s.length/d.count*100:100;return e.jsx("div",{className:"min-h-screen bg-background terminal-scanline",children:e.jsxs("div",{className:"max-w-5xl mx-auto p-3 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs(x,{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-matrix-green"}),e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider",children:"Your Referrals"})]}),e.jsxs(y,{variant:"outline",className:"text-xs","data-testid":"badge-referral-count",children:[o?"...":s.length," Friends"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-md bg-matrix-green/10 border border-matrix-green/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Y,{className:"w-4 h-4 text-matrix-green"}),e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider",children:"Rewards"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Earn ",e.jsx("span",{className:"font-bold text-matrix-green",children:"1,000 CS"})," when friends join. They get ",e.jsx("span",{className:"font-bold text-cyber-blue",children:"2,000 CS"})," bonus too!"]})]}),d&&e.jsxs("div",{className:"p-4 rounded-md bg-purple-500/10 border border-purple-500/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(p,{className:"w-4 h-4 text-purple-400"}),e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider",children:"Next Milestone"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s.length," / ",d.count," referrals"]}),e.jsx("span",{className:"font-bold text-purple-400",children:d.reward})]}),e.jsx(M,{value:I,className:"h-2"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:N.map(r=>e.jsxs(y,{variant:r.reached?"default":"outline",className:r.reached?"bg-purple-500":"",children:[r.count," â€¢ ",r.reward]},r.count))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground uppercase tracking-wider mb-2 block",children:"Your Referral Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:S?"Loading...":t!=null&&t.referralCode?`t.me/cryptohackerheist_bot?start=${t.referralCode}`:"",readOnly:!0,className:"font-mono text-xs","data-testid":"input-referral-link"}),e.jsx(g,{size:"icon",variant:"outline",onClick:$,disabled:!(t!=null&&t.referralCode),"data-testid":"button-copy-referral",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx(g,{size:"icon",variant:"outline",onClick:L,disabled:!(t!=null&&t.referralCode),"data-testid":"button-share-referral",children:e.jsx(z,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Your referrals have earned you:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 rounded-md bg-muted/30",children:[e.jsx("p",{className:"text-2xl font-bold font-mono text-matrix-green","data-testid":"text-total-bonus",children:o?"...":E.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Total CS"})]}),e.jsxs("div",{className:"text-center p-3 rounded-md bg-muted/30",children:[e.jsx("p",{className:"text-2xl font-bold font-mono text-cyber-blue","data-testid":"text-referral-count",children:o?"...":s.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Referrals"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-3 md:space-y-6",children:[T&&e.jsxs(x,{className:"p-4 md:p-6",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider mb-4",children:"Have a Referral Code?"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground uppercase tracking-wider mb-2 block",children:"Enter Referral Code"}),e.jsx(C,{value:i,onChange:r=>b(r.target.value),placeholder:"HACK4F2X",className:"font-mono","data-testid":"input-apply-referral-code",disabled:c.isPending})]}),e.jsx(g,{type:"submit",className:"w-full",disabled:c.isPending||!i.trim(),"data-testid":"button-apply-referral",children:c.isPending?"Applying...":"Apply Code & Earn 2,000 CS"})]})]}),e.jsxs(x,{className:"p-4 md:p-6",children:[e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider mb-4",children:"Your Referred Users"}),o?e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"Loading..."}):s.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No referrals yet. Share your link to start earning!"}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:s.map(r=>e.jsx("div",{className:"p-3 rounded-md bg-card border border-card-border hover-elevate transition-all","data-testid":`referral-item-${r.id}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm","data-testid":`text-referee-name-${r.id}`,children:r.referee.username||r.referee.firstName||"Anonymous User"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-1",children:[e.jsx(H,{className:"w-3 h-3"}),e.jsxs("span",{"data-testid":`text-join-date-${r.id}`,children:["Joined ",G(new Date(r.createdAt),"MMM d, yyyy")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-mono font-semibold text-matrix-green text-sm","data-testid":`text-bonus-${r.id}`,children:["+",r.bonusEarned.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"CS"})]})]})},r.id))})]})]})]}),e.jsxs(x,{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Q,{className:"w-5 h-5 text-matrix-green"}),e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-wider",children:"Top Referrers"})]}),R?e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"Loading leaderboard..."}):j.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"No referrers yet. Be the first to invite friends!"}):e.jsx("div",{className:"space-y-2",children:j.map((r,a)=>{const m=a+1,u=m<=3,q={1:"text-yellow-400",2:"text-gray-400",3:"text-amber-700"};return e.jsx("div",{className:`p-3 rounded-md ${u?"bg-gradient-to-r from-matrix-green/20 to-cyber-blue/20 border border-matrix-green/30":"bg-card border border-card-border"} hover-elevate transition-all`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`text-lg font-bold ${q[m]||"text-muted-foreground"}`,children:["#",m]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:r.username}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.referralCount," referral",r.referralCount!==1?"s":""]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-mono font-semibold text-matrix-green text-sm",children:r.totalBonus.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"CS earned"})]})]})},r.id)})})]})]})})}export{ae as default};
