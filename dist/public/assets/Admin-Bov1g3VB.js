import{f as R,r as o,a6 as be,a7 as ye,a8 as we,j as e,a9 as re,aa as Se,ab as Ce,ac as J,h as le,c as I,i as F,C,ad as te,e as h,B as T,k as ke,D as Te,l as Ee,m as De,n as Fe,O as v,q as k,x as Pe,U as ae,ae as Q,T as ne,af as _}from"./index-Dxl03dmW.js";import{I as q}from"./input-D6_NWspk.js";import{L as D}from"./label-CzaYXVui.js";import{D as H}from"./dollar-sign-BB7tunME.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=R("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=R("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=R("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=R("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=R("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=R("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=R("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=R("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);function Ie(n){const i=o.useRef({value:n,previous:n});return o.useMemo(()=>(i.current.value!==n&&(i.current.previous=i.current.value,i.current.value=n),i.current.previous),[n])}var Y="Switch",[Oe,We]=be(Y),[Ue,Be]=Oe(Y),ce=o.forwardRef((n,i)=>{const{__scopeSwitch:l,name:m,checked:r,defaultChecked:c,required:d,disabled:b,value:S="on",onCheckedChange:p,form:f,...P}=n,[E,M]=o.useState(null),A=ye(i,u=>M(u)),L=o.useRef(!1),t=E?f||!!E.closest("form"):!0,[g=!1,x]=we({prop:r,defaultProp:c,onChange:p});return e.jsxs(Ue,{scope:l,checked:g,disabled:b,children:[e.jsx(re.button,{type:"button",role:"switch","aria-checked":g,"aria-required":d,"data-state":me(g),"data-disabled":b?"":void 0,disabled:b,value:S,...P,ref:A,onClick:Se(n.onClick,u=>{x(y=>!y),t&&(L.current=u.isPropagationStopped(),L.current||u.stopPropagation())})}),t&&e.jsx(He,{control:E,bubbles:!L.current,name:m,value:S,checked:g,required:d,disabled:b,form:f,style:{transform:"translateX(-100%)"}})]})});ce.displayName=Y;var de="SwitchThumb",oe=o.forwardRef((n,i)=>{const{__scopeSwitch:l,...m}=n,r=Be(de,l);return e.jsx(re.span,{"data-state":me(r.checked),"data-disabled":r.disabled?"":void 0,...m,ref:i})});oe.displayName=de;var He=n=>{const{control:i,checked:l,bubbles:m=!0,...r}=n,c=o.useRef(null),d=Ie(l),b=Ce(i);return o.useEffect(()=>{const S=c.current,p=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(p,"checked").set;if(d!==l&&P){const E=new Event("click",{bubbles:m});P.call(S,l),S.dispatchEvent(E)}},[d,l,m]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l,...r,tabIndex:-1,ref:c,style:{...n.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function me(n){return n?"checked":"unchecked"}var xe=ce,Ke=oe;const V=o.forwardRef(({className:n,...i},l)=>e.jsx(xe,{className:J("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",n),...i,ref:l,children:e.jsx(Ke,{className:J("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));V.displayName=xe.displayName;const W=o.forwardRef(({className:n,...i},l)=>e.jsx("textarea",{className:J("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:l,...i}));W.displayName="Textarea";function $e(){const{toast:n}=le(),[i,l]=o.useState(!1),[m,r]=o.useState(null),[c,d]=o.useState({seasonId:"",name:"",description:"",startDate:"",endDate:"",bonusMultiplier:"1.0",specialRewards:""}),{data:b=[],isLoading:S}=I({queryKey:["/api/seasons"],queryFn:async()=>{const t=await fetch("/api/seasons");if(!t.ok)throw new Error("Failed to fetch seasons");return t.json()}}),p=F({mutationFn:async t=>{const g=v(),x=await fetch("/api/admin/seasons",{method:"POST",headers:{"Content-Type":"application/json","X-Telegram-Init-Data":g||""},body:JSON.stringify({...t,bonusMultiplier:parseFloat(t.bonusMultiplier)})});if(!x.ok){const u=await x.json();throw new Error(u.error||"Failed to create season")}return x.json()},onSuccess:t=>{k.invalidateQueries({queryKey:["/api/seasons"]}),n({title:"Season Created",description:t.message||"Season created successfully"}),l(!1),M()},onError:t=>{n({title:"Error",description:t.message,variant:"destructive"})}}),f=F({mutationFn:async({seasonId:t,data:g})=>{const x=v(),u=await fetch(`/api/admin/seasons/${t}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Telegram-Init-Data":x||""},body:JSON.stringify({...g,bonusMultiplier:parseFloat(g.bonusMultiplier)})});if(!u.ok){const y=await u.json();throw new Error(y.error||"Failed to update season")}return u.json()},onSuccess:t=>{k.invalidateQueries({queryKey:["/api/seasons"]}),n({title:"Season Updated",description:t.message||"Season updated successfully"}),l(!1),r(null),M()},onError:t=>{n({title:"Error",description:t.message,variant:"destructive"})}}),P=F({mutationFn:async({seasonId:t,isActive:g})=>{const x=v(),u=await fetch(`/api/admin/seasons/${t}/toggle`,{method:"POST",headers:{"Content-Type":"application/json","X-Telegram-Init-Data":x||""},body:JSON.stringify({isActive:g})});if(!u.ok){const y=await u.json();throw new Error(y.error||"Failed to toggle season")}return u.json()},onSuccess:t=>{k.invalidateQueries({queryKey:["/api/seasons"]}),k.invalidateQueries({queryKey:["/api/seasons/active"]}),n({title:t.message||"Season Updated",description:`Season has been ${t.season.isActive?"activated":"deactivated"}`})},onError:t=>{n({title:"Error",description:t.message,variant:"destructive"})}}),E=F({mutationFn:async t=>{const g=v(),x=await fetch(`/api/admin/seasons/${t}`,{method:"DELETE",headers:{"X-Telegram-Init-Data":g||""}});if(!x.ok){const u=await x.json();throw new Error(u.error||"Failed to delete season")}return x.json()},onSuccess:t=>{k.invalidateQueries({queryKey:["/api/seasons"]}),n({title:"Season Deleted",description:t.message||"Season deleted successfully"})},onError:t=>{n({title:"Error",description:t.message,variant:"destructive"})}}),M=()=>{d({seasonId:"",name:"",description:"",startDate:"",endDate:"",bonusMultiplier:"1.0",specialRewards:""})},A=t=>{r(t),d({seasonId:t.seasonId,name:t.name,description:t.description,startDate:new Date(t.startDate).toISOString().slice(0,16),endDate:new Date(t.endDate).toISOString().slice(0,16),bonusMultiplier:t.bonusMultiplier.toString(),specialRewards:t.specialRewards||""}),l(!0)},L=()=>{m?f.mutate({seasonId:m.seasonId,data:c}):p.mutate(c)};return e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Seasons Management"})]}),e.jsxs(h,{onClick:()=>{r(null),M(),l(!0)},size:"sm",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"New Season"]})]}),S?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading seasons..."}):b.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(te,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground opacity-30"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No seasons created yet"})]}):e.jsx("div",{className:"space-y-3",children:b.map(t=>{const g=new Date,x=new Date(t.startDate),u=new Date(t.endDate),y=t.isActive&&x<=g&&u>=g;return e.jsxs("div",{className:`p-4 rounded-lg border ${y?"bg-gradient-to-r from-purple-500/10 to-pink-500/10 border-purple-500/30":"bg-background/50 border-border"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:t.name}),y&&e.jsx(T,{className:"text-xs bg-purple-500",children:"LIVE"}),t.isActive&&!y&&e.jsx(T,{variant:"outline",className:"text-xs",children:"Active"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.toLocaleDateString()," - ",u.toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(h,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0",onClick:()=>A(t),children:e.jsx(Z,{className:"w-3 h-3"})}),e.jsx(h,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0",onClick:()=>P.mutate({seasonId:t.seasonId,isActive:!t.isActive}),children:t.isActive?e.jsx(Re,{className:"w-3 h-3 text-orange-500"}):e.jsx(Ae,{className:"w-3 h-3 text-green-500"})}),e.jsx(h,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0",onClick:()=>{confirm(`Delete season "${t.name}"?`)&&E.mutate(t.seasonId)},children:e.jsx(ke,{className:"w-3 h-3 text-destructive"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs mt-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Bonus Multiplier:"}),e.jsxs("span",{className:"ml-1 font-mono text-matrix-green",children:[t.bonusMultiplier,"x"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Season ID:"}),e.jsx("span",{className:"ml-1 font-mono",children:t.seasonId})]})]})]},t.id)})}),e.jsx(Te,{open:i,onOpenChange:l,children:e.jsxs(Ee,{className:"max-w-2xl",children:[e.jsx(De,{children:e.jsx(Fe,{children:m?"Edit Season":"Create New Season"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"seasonId",children:"Season ID"}),e.jsx(q,{id:"seasonId",value:c.seasonId,onChange:t=>d({...c,seasonId:t.target.value}),placeholder:"winter-2024",disabled:!!m})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"name",children:"Season Name"}),e.jsx(q,{id:"name",value:c.name,onChange:t=>d({...c,name:t.target.value}),placeholder:"Winter Wonderland"})]})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"description",children:"Description"}),e.jsx(W,{id:"description",value:c.description,onChange:t=>d({...c,description:t.target.value}),placeholder:"A festive winter event with bonus rewards...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"startDate",children:"Start Date"}),e.jsx(q,{id:"startDate",type:"datetime-local",value:c.startDate,onChange:t=>d({...c,startDate:t.target.value})})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"endDate",children:"End Date"}),e.jsx(q,{id:"endDate",type:"datetime-local",value:c.endDate,onChange:t=>d({...c,endDate:t.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"bonusMultiplier",children:"Bonus Multiplier"}),e.jsx(q,{id:"bonusMultiplier",type:"number",step:"0.1",min:"1",value:c.bonusMultiplier,onChange:t=>d({...c,bonusMultiplier:t.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"2.0 = 2x referral bonuses, mining rewards, etc."})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"specialRewards",children:"Special Rewards (JSON)"}),e.jsx(W,{id:"specialRewards",value:c.specialRewards,onChange:t=>d({...c,specialRewards:t.target.value}),placeholder:'{"equipment": ["asic-s19"], "cs": 10000}',rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional: JSON object for special season rewards"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",className:"flex-1",onClick:()=>{l(!1),r(null),M()},children:"Cancel"}),e.jsx(h,{className:"flex-1",onClick:L,disabled:p.isPending||f.isPending,children:p.isPending||f.isPending?"Saving...":m?"Update Season":"Create Season"})]})]})]})})]})}function Ze(){const{toast:n}=le(),[i,l]=o.useState(!1),[m,r]=o.useState(""),[c,d]=o.useState(!1),[b,S]=o.useState(null),[p,f]=o.useState(""),[P,E]=o.useState(""),[M,A]=o.useState(null),[L,t]=o.useState(null),[g,x]=o.useState(""),[u,y]=o.useState(""),{data:U,isLoading:Qe}=I({queryKey:["/api/admin/settings"],queryFn:async()=>{const s=v();if(!s)throw new Error("Not authenticated");const a=await fetch("/api/admin/settings",{headers:{"X-Telegram-Init-Data":s}});if(!a.ok)throw new Error("Failed to fetch settings");return a.json()}}),{data:j,isLoading:B}=I({queryKey:["/api/admin/users"],queryFn:async()=>{const s=v();if(!s)throw new Error("Not authenticated");const a=await fetch("/api/admin/users",{headers:{"X-Telegram-Init-Data":s}});if(!a.ok)throw new Error("Failed to fetch users");return a.json()}}),{data:K,isLoading:ue}=I({queryKey:["/api/equipment-types"]}),{data:$,isLoading:he}=I({queryKey:["/api/admin/feature-flags"],queryFn:async()=>{const s=v();if(!s)throw new Error("Not authenticated");const a=await fetch("/api/admin/feature-flags",{headers:{"X-Telegram-Init-Data":s}});if(!a.ok)throw new Error("Failed to fetch feature flags");return a.json()}});o.useEffect(()=>{const s=U==null?void 0:U.find(a=>a.key==="mining_paused");l((s==null?void 0:s.value)==="true")},[U]);const pe=F({mutationFn:async s=>{const a=v();if(!a)throw new Error("Not authenticated");const w=await fetch(s?"/api/admin/mining/pause":"/api/admin/mining/resume",{method:"POST",headers:{"X-Telegram-Init-Data":a}});if(!w.ok)throw new Error("Failed to update mining status");return w.json()},onSuccess:(s,a)=>{l(a),k.invalidateQueries({queryKey:["/api/admin/settings"]}),n({title:a?"Mining Paused":"Mining Resumed",description:a?"Block mining has been paused":"Block mining has resumed"})}}),ge=F({mutationFn:async({userId:s,isAdmin:a})=>{const N=v();if(!N)throw new Error("Not authenticated");const w=await fetch(`/api/admin/users/${s}/admin`,{method:"POST",headers:{"Content-Type":"application/json","X-Telegram-Init-Data":N},body:JSON.stringify({isAdmin:a})});if(!w.ok)throw new Error("Failed to update admin status");return w.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"Admin Status Updated",description:"User permissions have been changed"})}}),fe=F({mutationFn:async({userId:s,csBalance:a,chstBalance:N})=>{const w=v();if(!w)throw new Error("Not authenticated");const O=await fetch(`/api/admin/users/${s}/balance`,{method:"POST",headers:{"Content-Type":"application/json","X-Telegram-Init-Data":w},body:JSON.stringify({csBalance:a,chstBalance:N})});if(!O.ok)throw new Error("Failed to update balance");return O.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/admin/users"]}),t(null),x(""),y(""),n({title:"Balance Updated",description:"User balance has been updated successfully"})}}),z=F({mutationFn:async()=>{const s=v();if(!s)throw new Error("Not authenticated");const a=await fetch("/api/admin/reset-all-users",{method:"DELETE",headers:{"Content-Type":"application/json","X-Telegram-Init-Data":s}});if(!a.ok)throw new Error("Failed to reset game data");return a.json()},onSuccess:s=>{k.invalidateQueries({queryKey:["/api/admin/users"]}),r(""),d(!1),n({title:"Game Reset Successful",description:`Reset ${s.users_reset} users and deleted ${Object.values(s.records_deleted||{}).reduce((a,N)=>a+(N||0),0)} records`})},onError:s=>{n({title:"Reset Failed",description:s.message||"Failed to reset game data",variant:"destructive"})}}),X=F({mutationFn:async()=>{const s=v();if(!s)throw new Error("Not authenticated");const a=await fetch("/api/admin/recalculate-hashrates",{method:"POST",headers:{"Content-Type":"application/json","X-Telegram-Init-Data":s}});if(!a.ok)throw new Error("Failed to recalculate hashrates");return a.json()},onSuccess:s=>{k.invalidateQueries({queryKey:["/api/admin/users"]}),n({title:"Hashrates Recalculated",description:`Updated ${s.usersUpdated} out of ${s.totalUsers} users with corrected hashrates`})},onError:s=>{n({title:"Recalculation Failed",description:s.message||"Failed to recalculate hashrates",variant:"destructive"})}}),ee=F({mutationFn:async({equipmentId:s,basePrice:a,currency:N})=>{const w=v();if(!w)throw new Error("Not authenticated");const O=await fetch(`/api/admin/equipment/${s}/update`,{method:"POST",headers:{"Content-Type":"application/json","X-Telegram-Init-Data":w},body:JSON.stringify({basePrice:a,currency:N})});if(!O.ok)throw new Error("Failed to update equipment");return O.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/equipment-types"]}),S(null),f(""),E(""),n({title:"Equipment Updated",description:"Price and currency have been updated successfully"})},onError:s=>{n({title:"Update Failed",description:s.message||"Failed to update equipment",variant:"destructive"})}}),se=F({mutationFn:async({featureKey:s,isEnabled:a})=>{const N=v();if(!N)throw new Error("Not authenticated");const w=await fetch(`/api/admin/feature-flags/${s}`,{method:"POST",headers:{"Content-Type":"application/json","X-Telegram-Init-Data":N},body:JSON.stringify({isEnabled:a})});if(!w.ok)throw new Error("Failed to update feature flag");return w.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/admin/feature-flags"]}),k.invalidateQueries({queryKey:["/api/feature-flags"]}),n({title:"Feature Updated",description:"Feature visibility has been changed"})},onError:s=>{n({title:"Update Failed",description:s.message||"Failed to update feature flag",variant:"destructive"})}}),je=(j==null?void 0:j.length)||0,Ne=(j==null?void 0:j.reduce((s,a)=>s+a.csBalance,0))||0,ve=(j==null?void 0:j.reduce((s,a)=>s+a.totalHashrate,0))||0;return e.jsx("div",{className:"min-h-screen bg-background p-2 md:p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-md bg-destructive/20 flex items-center justify-center",children:e.jsx(Pe,{className:"w-6 h-6 text-destructive"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Game Management Console"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-4 h-4 text-cyber-blue"}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Total Users"})]}),e.jsx("p",{className:"text-2xl font-bold font-mono","data-testid":"text-total-users",children:B?"...":je})]}),e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(H,{className:"w-4 h-4 text-matrix-green"}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Total CS"})]}),e.jsx("p",{className:"text-2xl font-bold font-mono text-matrix-green","data-testid":"text-total-cs",children:B?"...":Ne.toLocaleString()})]}),e.jsxs(C,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"w-4 h-4 text-neon-orange"}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Total HR"})]}),e.jsx("p",{className:"text-2xl font-bold font-mono","data-testid":"text-total-hashrate",children:B?"...":ve.toLocaleString()})]})]}),e.jsxs(C,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Mining Control"]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i?e.jsx(Me,{className:"w-5 h-5 text-destructive"}):e.jsx(Le,{className:"w-5 h-5 text-matrix-green"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Block Mining"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i?"Currently paused":"Currently active"})]})]}),e.jsx(h,{onClick:()=>pe.mutate(!i),variant:i?"default":"destructive","data-testid":i?"button-resume-mining":"button-pause-mining",children:i?"Resume Mining":"Pause Mining"})]})]}),e.jsxs(C,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-purple-500"}),"Feature Flags - Enable/Disable Pages"]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Control which features and pages are visible to users in navigation"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:he?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading feature flags..."}):$&&$.length>0?$.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 rounded-md",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold",children:s.featureName}),s.isEnabled?e.jsx(T,{className:"text-xs bg-matrix-green text-black",children:"Enabled"}):e.jsx(T,{variant:"secondary",className:"text-xs",children:"Disabled"})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description}),e.jsxs("p",{className:"text-xs text-muted-foreground/70 mt-1",children:["Key: ",s.featureKey]})]}),e.jsx(V,{checked:s.isEnabled,onCheckedChange:a=>se.mutate({featureKey:s.featureKey,isEnabled:a}),disabled:se.isPending})]},s.id)):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(ie,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No feature flags configured"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Feature flags will be seeded automatically on first deploy"})]})})]}),e.jsxs(C,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Equipment Price Management"]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Modify equipment prices and currency types (CS, CHST, or TON)"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:ue?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading equipment..."}):K==null?void 0:K.map(s=>e.jsx("div",{className:"flex items-center justify-between p-4 bg-muted/30 rounded-md",children:b===s.id?e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm mb-2",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(D,{htmlFor:`price-${s.id}`,className:"text-xs",children:"Price"}),e.jsx(q,{id:`price-${s.id}`,type:"number",value:p,onChange:a=>f(a.target.value),placeholder:s.basePrice.toString(),className:"mt-1"})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(D,{htmlFor:`currency-${s.id}`,className:"text-xs",children:"Currency"}),e.jsxs("select",{id:`currency-${s.id}`,value:P,onChange:a=>E(a.target.value),className:"mt-1 w-full h-10 px-3 rounded-md border border-input bg-background",children:[e.jsx("option",{value:"CS",children:"CS"}),e.jsx("option",{value:"CHST",children:"CHST"}),e.jsx("option",{value:"TON",children:"TON"})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"sm",onClick:()=>{const a=p?parseFloat(p):void 0,N=P||void 0;(a||N)&&ee.mutate({equipmentId:s.id,basePrice:a,currency:N})},disabled:ee.isPending,children:"Save"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>{S(null),f(""),E("")},children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.category," • ",s.tier]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-mono text-sm font-semibold",children:[s.basePrice.toLocaleString()," ",s.currency]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.baseHashrate.toLocaleString()," H/s"]})]}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>{S(s.id),f(s.basePrice.toString()),E(s.currency)},children:e.jsx(Z,{className:"w-4 h-4"})})]})]})},s.id))})]}),e.jsxs(C,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"User Management"]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:B?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading users..."}):j==null?void 0:j.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 rounded-md","data-testid":`user-row-${s.id}`,children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.username}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["CS: ",s.csBalance.toLocaleString()," | HR: ",s.totalHashrate.toFixed(0)]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[s.isAdmin&&e.jsx(T,{variant:"destructive",className:"text-xs",children:"Admin"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>A(s.id),className:"text-xs",children:"View Payments"}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>{t(s.id),x(s.csBalance.toString()),y(s.chstBalance.toString())},className:"text-xs",children:"Edit Balance"}),e.jsx(V,{checked:s.isAdmin,onCheckedChange:a=>ge.mutate({userId:s.id,isAdmin:a}),"data-testid":`switch-admin-${s.id}`})]})]},s.id))})]}),M&&e.jsx(ze,{userId:M,onClose:()=>A(null)}),L&&e.jsx(Xe,{userId:L,user:j==null?void 0:j.find(s=>s.id===L),editCs:g,editChst:u,setEditCs:x,setEditChst:y,updateBalanceMutation:fe,onClose:()=>{t(null),x(""),y("")}}),e.jsxs(C,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Game Content Overview"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted/30 rounded-md",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx(T,{variant:"outline",className:"text-xs",children:"Daily Challenges"})}),e.jsx("p",{className:"text-2xl font-bold",children:"5"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active challenges"})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-md",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx(T,{variant:"outline",className:"text-xs",children:"Achievements"})}),e.jsx("p",{className:"text-2xl font-bold",children:"8"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total achievements"})]}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-md",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx(T,{variant:"outline",className:"text-xs",children:"Cosmetics"})}),e.jsx("p",{className:"text-2xl font-bold",children:"13"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Available items"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"💡 Game content is automatically seeded from server/seedGameContent.ts. To modify challenges, achievements, or cosmetic items, update that file and redeploy."})]}),e.jsx($e,{}),e.jsxs(C,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-cyan-500"}),"Recalculate Hashrates"]}),e.jsx("div",{className:"p-4 bg-cyan-500/10 border border-cyan-500/30 rounded-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-cyan-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Fix Hashrate Inconsistencies"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"This will recalculate all users' total hashrate based on their actual equipment. Use this to fix data inconsistencies (e.g., user shows hashrate but has no rigs). This is a safe operation that only updates hashrate values."}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>X.mutate(),disabled:X.isPending,className:"border-cyan-500 text-cyan-500 hover:bg-cyan-500/10",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),X.isPending?"Recalculating...":"Recalculate All Hashrates"]})]})]})})]}),e.jsxs(C,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-destructive"}),"Game Reset"]}),c?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/30 rounded-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-destructive font-semibold mb-2",children:"⚠️ DANGER ZONE ⚠️"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"This will permanently delete ALL game data for ALL users:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground list-disc list-inside space-y-1 mb-3",children:[e.jsx("li",{children:"All equipment and upgrades"}),e.jsx("li",{children:"All CS and CHST balances"}),e.jsx("li",{children:"All hashrate and mining progress"}),e.jsx("li",{children:"All block rewards and referrals"})]}),e.jsx("p",{className:"text-sm text-destructive font-semibold",children:"This action CANNOT be undone!"})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"reset-confirm",className:"text-sm font-medium",children:'Type "RESET ALL DATA" to confirm:'}),e.jsx(q,{id:"reset-confirm",value:m,onChange:s=>r(s.target.value),placeholder:"RESET ALL DATA",className:"mt-1"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"destructive",disabled:m!=="RESET ALL DATA"||z.isPending,onClick:()=>{z.mutate()},children:z.isPending?"Resetting...":e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Reset All Users"]})}),e.jsx(h,{variant:"outline",onClick:()=>{d(!1),r("")},children:"Cancel"})]})]})]}):e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/30 rounded-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-destructive font-semibold mb-2",children:"Reset Game Data"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"This will permanently delete all user equipment, balances, hashrate, and progress. This action cannot be undone."}),e.jsxs(h,{variant:"destructive",size:"sm",onClick:()=>d(!0),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Show Reset Options"]})]})]})})]})]})})}function ze({userId:n,onClose:i}){const{data:l,isLoading:m}=I({queryKey:[`/api/admin/users/${n}/payment-history`],queryFn:async()=>{const r=v();if(!r)throw new Error("Not authenticated");const c=await fetch(`/api/admin/users/${n}/payment-history`,{headers:{"X-Telegram-Init-Data":r}});if(!c.ok)throw new Error("Failed to fetch payment history");return c.json()}});return e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-yellow-500"}),"Payment Logs - User ",n.slice(0,8),"..."]}),e.jsx(h,{size:"sm",variant:"outline",onClick:i,children:"Close"})]}),m?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading payment history..."}):l&&l.payments.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-md",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase mb-1",children:"Total TON Spent"}),e.jsxs("p",{className:"text-2xl font-bold font-mono text-yellow-500",children:[l.totalTonSpent," TON"]})]}),e.jsxs("div",{className:"p-4 bg-cyan-500/10 border border-cyan-500/30 rounded-md",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase mb-1",children:"Total Purchases"}),e.jsx("p",{className:"text-2xl font-bold font-mono text-cyan-500",children:l.totalPayments})]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:l.payments.map(r=>e.jsxs("div",{className:"p-4 bg-muted/30 rounded-md border border-border",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(T,{variant:r.verified?"default":"secondary",className:"text-xs",children:r.type}),r.verified&&e.jsx(T,{variant:"outline",className:"text-xs border-green-500 text-green-500",children:"Verified"})]}),e.jsx("p",{className:"font-semibold text-sm capitalize",children:r.itemName.replace(/_/g," ")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(r.purchasedAt).toLocaleString()})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-mono font-bold text-yellow-500",children:[r.tonAmount," TON"]})})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Transaction Hash:"}),e.jsx("p",{className:"text-xs font-mono break-all bg-black/20 p-2 rounded",children:r.transactionHash})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-border/50",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Rewards:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.rewards.cs>0&&e.jsxs(T,{variant:"outline",className:"text-xs",children:[r.rewards.cs.toLocaleString()," CS"]}),r.rewards.chst>0&&e.jsxs(T,{variant:"outline",className:"text-xs",children:[r.rewards.chst.toLocaleString()," CHST"]}),r.rewards.items&&r.rewards.items.length>0&&r.rewards.items.map((c,d)=>e.jsx(T,{variant:"outline",className:"text-xs capitalize",children:c.replace(/_/g," ")},d))]})]})]},r.id))})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(H,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No payment history found for this user."}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"TON purchases will appear here once made."})]})]})}function Xe({userId:n,user:i,editCs:l,editChst:m,setEditCs:r,setEditChst:c,updateBalanceMutation:d,onClose:b}){const S=()=>{const p=l?parseFloat(l):void 0,f=m?parseFloat(m):void 0;(p!==void 0||f!==void 0)&&d.mutate({userId:n,csBalance:p,chstBalance:f})};return e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-matrix-green"}),"Edit Balance - ",(i==null?void 0:i.username)||n.slice(0,8)+"..."]}),e.jsx(h,{size:"sm",variant:"outline",onClick:b,children:"Close"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-muted/30 rounded-md",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Current Balances:"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"CS"}),e.jsx("p",{className:"text-lg font-mono font-bold text-matrix-green",children:(i==null?void 0:i.csBalance.toLocaleString())||"0"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"CHST"}),e.jsx("p",{className:"text-lg font-mono font-bold text-cyber-blue",children:(i==null?void 0:i.chstBalance.toLocaleString())||"0"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"edit-cs",className:"text-sm font-medium",children:"New CS Balance"}),e.jsx(q,{id:"edit-cs",type:"number",value:l,onChange:p=>r(p.target.value),placeholder:"Enter CS amount",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"edit-chst",className:"text-sm font-medium",children:"New CHST Balance"}),e.jsx(q,{id:"edit-chst",type:"number",value:m,onChange:p=>c(p.target.value),placeholder:"Enter CHST amount",className:"mt-1"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{onClick:S,disabled:d.isPending||!l&&!m,className:"bg-matrix-green hover:bg-matrix-green/90 text-black",children:d.isPending?"Updating...":"Update Balance"}),e.jsx(h,{variant:"outline",onClick:b,children:"Cancel"})]}),e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-md",children:e.jsx("p",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:"⚠️ This will set the user's balance to the exact amounts entered. Use this for testing or support purposes."})})]})]})}export{Ze as default};
