import{h as E,r as j,N as H,c as _,s as q,i as I,j as e,C as a,e as o,a6 as b,B as N,M as L,F as T,H as F,I as M,p as U,q as O}from"./index-CqdhH_L-.js";import{u as $,s as z}from"./tonConnect-sFZRVh1d.js";import{C as Q}from"./circle-alert-C-t9oTSn.js";import{R as A}from"./refresh-cw-CYIjN1aS.js";const D="UQBdFhwckY9C8MU0AC4uiPbRH_C3QIjZH6OzV47ROfHjnyfe";function Z(){const{toast:d}=E(),{tonConnectUI:u,isConnected:P}=$(),[m,W]=j.useState(null),[i,x]=j.useState(!1),[r,B]=j.useState(null);j.useEffect(()=>{H().then(W).catch(s=>console.error("Failed to initialize user:",s))},[]);const{data:l,isLoading:y,error:v,refetch:w}=_({queryKey:["/api/user",m,"spin","status"],enabled:!!m,refetchInterval:1e4}),S=q({isLoading:y,timeoutMs:5e3}),c=I({mutationFn:async({isFree:s,quantity:p,tonData:t})=>{const n={isFree:s,quantity:p||1};return!s&&t&&(n.tonTransactionHash=t.txHash,n.userWalletAddress=t.userWallet,n.tonAmount=t.amount),(await U("POST",`/api/user/${m}/spin`,n)).json()},onSuccess:s=>{x(!1),B(s),O.invalidateQueries({queryKey:["/api/user",m,"spin"]}),O.invalidateQueries({queryKey:["/api/user",m]}),d({title:s.summary.jackpot_won?"🎰 JACKPOT WIN! 🎰":"🎉 You Won!",description:s.message})},onError:s=>{x(!1),d({title:"Spin Failed",description:s.message||"Failed to spin the wheel",variant:"destructive"})}}),K=()=>{if(!(l!=null&&l.freeSpinAvailable)){d({title:"Not Available",description:"Free spin already used today. Come back tomorrow!",variant:"destructive"});return}x(!0),c.mutate({isFree:!0,quantity:1})},g=async s=>{var n,f,k;if(!P){await u.openModal();return}const t={1:"0.1",10:"0.9",20:"1.7"}[s];if(!t){d({title:"Invalid Quantity",description:"Please select 1, 10, or 20 spins",variant:"destructive"});return}x(!0);try{const h=await z(u,D,t,`Spin Wheel x${s}`);if(h){const R=((f=(n=u.wallet)==null?void 0:n.account)==null?void 0:f.address)||((k=u.account)==null?void 0:k.address);c.mutate({isFree:!1,quantity:s,tonData:{txHash:h,amount:t,userWallet:R}})}else throw new Error("Transaction cancelled")}catch(h){x(!1),d({title:"Transaction Failed",description:h.message||"Failed to send TON transaction",variant:"destructive"})}};if(v)return e.jsx("div",{className:"min-h-screen bg-background p-3",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(a,{className:"p-6 border-destructive/50",children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-4",children:[e.jsx(Q,{className:"w-12 h-12 text-destructive"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Failed to Load Spin Wheel"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:v.message||"Something went wrong loading the spin wheel."})]}),e.jsxs(o,{onClick:()=>w(),className:"min-h-11",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})})})});if(y||!l)return e.jsx("div",{className:"min-h-screen bg-background p-3",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(a,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-4",children:[e.jsx(b,{className:"w-12 h-12 animate-spin text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold mb-2",children:S?"Still loading...":"Loading spin wheel..."}),S&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This is taking longer than expected. Check your connection."}),e.jsxs(o,{onClick:()=>w(),variant:"outline",className:"min-h-11",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Retry"]})]})]})]})})})});const C=[{type:"jackpot",label:"1 TON",color:"from-yellow-400 to-orange-500",icon:"🎰"},{type:"cs",label:"1K CS",color:"from-green-500 to-emerald-500",icon:"💰"},{type:"chst",label:"100 CHST",color:"from-blue-500 to-cyan-500",icon:"💎"},{type:"cs",label:"5K CS",color:"from-green-500 to-emerald-500",icon:"💰"},{type:"powerup",label:"Boost",color:"from-purple-500 to-pink-500",icon:"⚡"},{type:"cs",label:"10K CS",color:"from-yellow-500 to-orange-500",icon:"💰"},{type:"equipment",label:"Equipment",color:"from-red-500 to-pink-500",icon:"🎁"},{type:"cs",label:"2.5K CS",color:"from-green-500 to-emerald-500",icon:"💰"}];return e.jsx("div",{className:"min-h-screen bg-background p-3",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-md bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Spin the Wheel"}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Win prizes + 1 TON jackpot!"})]})]}),e.jsx(a,{className:"p-4 bg-gradient-to-r from-purple-500/10 to-pink-500/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Free Spin Today"}),e.jsx(N,{variant:l.freeSpinAvailable?"default":"outline",className:"mt-1",children:l.freeSpinAvailable?"Available":"Used"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paid Spins Today"}),e.jsx("p",{className:"text-2xl font-bold",children:l.paidSpinsCount})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Bulk Discounts"}),e.jsx("p",{className:"text-sm font-bold text-green-500",children:"10-15% OFF"})]})]})}),r&&e.jsx(a,{className:"p-4 bg-gradient-to-r from-yellow-500/10 to-orange-500/10 border-yellow-500/30",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-6 h-6 text-yellow-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold",children:"Last Spin Result:"}),r.summary.jackpot_won&&e.jsx("p",{className:"text-lg font-bold text-yellow-500 animate-pulse",children:"🎰 1 TON JACKPOT WON! 🎰"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.summary.spins_completed," spin(s):",r.summary.total_cs>0&&` ${r.summary.total_cs.toLocaleString()} CS`,r.summary.total_chst>0&&` ${r.summary.total_chst.toLocaleString()} CHST`]})]})]})}),e.jsx(a,{className:"p-8 bg-gradient-to-br from-purple-500/5 to-pink-500/5",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:`mx-auto w-64 h-64 rounded-full border-8 border-primary relative overflow-hidden ${i?"animate-spin":""}`,style:{animationDuration:"2s"},children:[C.map((s,p)=>{const t=360/C.length*p;return e.jsx("div",{className:`absolute w-full h-full bg-gradient-to-br ${s.color}`,style:{transform:`rotate(${t}deg)`,clipPath:"polygon(50% 50%, 100% 0%, 100% 50%)",opacity:s.type==="jackpot"?1:.8}},p)}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 rounded-full bg-background border-4 border-primary flex items-center justify-center",children:e.jsx(T,{className:"w-8 h-8 text-primary"})})]}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2",children:e.jsx("div",{className:"w-0 h-0 border-l-[20px] border-l-transparent border-r-[20px] border-r-transparent border-t-[40px] border-t-primary"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs(a,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(F,{className:"w-6 h-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Free Daily Spin"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"1 free spin every 24 hours"})]})]}),e.jsx(o,{className:"w-full h-12 text-lg",onClick:K,disabled:!l.freeSpinAvailable||i||c.isPending,children:i?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-5 h-5 mr-2 animate-spin"}),"Spinning..."]}):l.freeSpinAvailable?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-5 h-5 mr-2"}),"Spin Free!"]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-5 h-5 mr-2"}),"Come Back Tomorrow"]})})]}),e.jsxs(a,{className:"p-6 bg-gradient-to-br from-blue-500/10 to-purple-500/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Buy Extra Spins"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bulk purchases with discount!"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs(o,{className:"h-16 flex flex-col items-center justify-center bg-blue-500 hover:bg-blue-600",onClick:()=>g(1),disabled:i||c.isPending,children:[e.jsx("span",{className:"text-lg font-bold",children:"1"}),e.jsx("span",{className:"text-xs",children:"0.1 TON"})]}),e.jsxs(o,{className:"h-16 flex flex-col items-center justify-center bg-blue-500 hover:bg-blue-600 relative",onClick:()=>g(10),disabled:i||c.isPending,children:[e.jsx(N,{className:"absolute -top-2 -right-2 bg-green-500 text-xs",children:"-10%"}),e.jsx("span",{className:"text-lg font-bold",children:"10"}),e.jsx("span",{className:"text-xs",children:"0.9 TON"})]}),e.jsxs(o,{className:"h-16 flex flex-col items-center justify-center bg-blue-500 hover:bg-blue-600 relative",onClick:()=>g(20),disabled:i||c.isPending,children:[e.jsx(N,{className:"absolute -top-2 -right-2 bg-green-500 text-xs",children:"-15%"}),e.jsx("span",{className:"text-lg font-bold",children:"20"}),e.jsx("span",{className:"text-xs",children:"1.7 TON"})]})]})]})]}),e.jsxs(a,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Possible Prizes"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsxs("div",{className:"p-3 bg-yellow-500/20 rounded-lg text-center border border-yellow-500/50",children:[e.jsx("p",{className:"text-2xl mb-1",children:"🎰"}),e.jsx("p",{className:"text-sm font-semibold text-yellow-500",children:"1 TON"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"0.1% chance"})]}),e.jsxs("div",{className:"p-3 bg-green-500/10 rounded-lg text-center",children:[e.jsx("p",{className:"text-2xl mb-1",children:"💰"}),e.jsx("p",{className:"text-sm font-semibold",children:"1K-25K CS"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"40% chance"})]}),e.jsxs("div",{className:"p-3 bg-blue-500/10 rounded-lg text-center",children:[e.jsx("p",{className:"text-2xl mb-1",children:"💎"}),e.jsx("p",{className:"text-sm font-semibold",children:"50-500 CHST"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"30% chance"})]}),e.jsxs("div",{className:"p-3 bg-purple-500/10 rounded-lg text-center",children:[e.jsx("p",{className:"text-2xl mb-1",children:"⚡"}),e.jsx("p",{className:"text-sm font-semibold",children:"Power-Up"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"20% chance"})]}),e.jsxs("div",{className:"p-3 bg-yellow-500/10 rounded-lg text-center",children:[e.jsx("p",{className:"text-2xl mb-1",children:"🎁"}),e.jsx("p",{className:"text-sm font-semibold",children:"Equipment"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"10% chance"})]})]})]}),e.jsxs(a,{className:"p-4 bg-muted/30",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["🎰 ",e.jsx("strong",{children:"Jackpot Prize:"})," Win 1 TON with paid spins! 0.1% chance (1 in 1000). Admin will process your payout."]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["💡 ",e.jsx("strong",{children:"Bulk Discounts:"})," Buy 10 spins for 10% off or 20 spins for 15% off!"]})]})]})})}export{Z as default};
