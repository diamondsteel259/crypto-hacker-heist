import{h as M,r as h,N as R,c as k,s as B,i as S,j as e,C as u,a2 as I,e as c,B as g,F as E,a3 as f,a4 as j,p as O,q as N}from"./index-CqdhH_L-.js";import{u as U,s as z}from"./tonConnect-sFZRVh1d.js";import{R as Q}from"./refresh-cw-CYIjN1aS.js";const _="UQBdFhwckY9C8MU0AC4uiPbRH_C3QIjZH6OzV47ROfHjnyfe";function W(){const{toast:o}=M(),{tonConnectUI:b,isConnected:F}=U(),[l,P]=h.useState(null),[m,A]=h.useState("background");h.useEffect(()=>{R().then(P).catch(s=>console.error("Failed to initialize user:",s))},[]);const{data:r,isLoading:v,refetch:H}=k({queryKey:["/api/cosmetics"]}),{data:t,isLoading:y}=k({queryKey:["/api/user",l,"cosmetics"],enabled:!!l}),C=B({isLoading:v||y,timeoutMs:5e3}),d=S({mutationFn:async({cosmeticId:s,currency:a,tonData:i})=>{const n={currency:a};return a==="TON"&&i&&(n.tonTransactionHash=i.txHash,n.userWalletAddress=i.userWallet,n.tonAmount=i.amount),(await O("POST",`/api/user/${l}/cosmetics/${s}/purchase`,n)).json()},onSuccess:s=>{N.invalidateQueries({queryKey:["/api/user",l,"cosmetics"]}),N.invalidateQueries({queryKey:["/api/user",l]}),o({title:"Purchase Successful!",description:s.message||"Cosmetic item purchased!"})},onError:s=>{o({title:"Purchase Failed",description:s.message||"Failed to purchase cosmetic",variant:"destructive"})}}),p=S({mutationFn:async({cosmeticId:s,equipped:a})=>(await O("POST",`/api/user/${l}/cosmetics/${s}/equip`,{equipped:a})).json(),onSuccess:(s,a)=>{N.invalidateQueries({queryKey:["/api/user",l,"cosmetics"]}),a.equipped;const i=m==="background"?"Your profile now shows this custom background!":m==="nameColor"?"Your username now displays in this color!":"This badge now appears on your profile!";o({title:a.equipped?"✨ Cosmetic Equipped!":"Cosmetic Unequipped",description:a.equipped?i:"Cosmetic removed from your profile."})},onError:s=>{o({title:"Action Failed",description:s.message||"Failed to update cosmetic",variant:"destructive"})}}),w=(s,a)=>{p.mutate({cosmeticId:s,equipped:!a})},x=async s=>{let a="CS";if(s.priceTon&&!s.priceCs&&!s.priceChst?a="TON":s.priceChst&&!s.priceCs&&(a="CHST"),a==="TON"&&s.priceTon){if(!F){await b.openModal();return}try{const i=await z(b,_,s.priceTon,`Cosmetic: ${s.name}`);if(i)d.mutate({cosmeticId:s.itemId,currency:"TON",tonData:{txHash:i}});else throw new Error("Transaction cancelled")}catch(i){o({title:"Transaction Failed",description:i.message||"Failed to send TON transaction",variant:"destructive"})}}else d.mutate({cosmeticId:s.itemId,currency:a})};if(v||y)return e.jsx("div",{className:"min-h-screen bg-background p-3",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-4",children:[e.jsx(I,{className:"w-12 h-12 animate-pulse text-primary"}),e.jsx("p",{className:"text-lg font-semibold",children:C?"Still loading cosmetics...":"Loading cosmetics shop..."}),C&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"This is taking longer than expected. Check your connection."}),e.jsxs(c,{onClick:()=>H(),variant:"outline",className:"min-h-11",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Retry"]})]})]})})})});const L=[{id:"background",name:"Backgrounds",icon:"🎨"},{id:"nameColor",name:"Name Colors",icon:"✨"},{id:"badge",name:"Badges",icon:"🏅"}],T=(r==null?void 0:r.filter(s=>s.category===m))||[];return t!=null&&t.map(s=>s.cosmeticId),e.jsx("div",{className:"min-h-screen bg-background p-3",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-md bg-gradient-to-br from-pink-500 to-purple-500 flex items-center justify-center",children:e.jsx(I,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Cosmetics Shop"}),e.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Customize your profile with unique items"})]})]}),e.jsx(u,{className:"p-4 bg-gradient-to-r from-purple-500/10 to-pink-500/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Owned Items"}),e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Available"}),e.jsx("p",{className:"text-2xl font-bold",children:(r==null?void 0:r.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Collection"}),e.jsxs("p",{className:"text-2xl font-bold",children:[r&&r.length>0?Math.round(((t==null?void 0:t.length)||0)/r.length*100):0,"%"]})]})]})}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:L.map(s=>e.jsxs(c,{variant:m===s.id?"default":"outline",size:"lg",onClick:()=>A(s.id),className:"whitespace-nowrap",children:[e.jsx("span",{className:"mr-2",children:s.icon}),s.name]},s.id))}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(s=>{const a=t==null?void 0:t.find(q=>q.cosmeticId===s.itemId),i=!!a,n=(a==null?void 0:a.isEquipped)||!1;return e.jsxs(u,{className:`p-4 transition-all ${n?"bg-gradient-to-br from-matrix-green/20 to-cyan-500/20 border-matrix-green/50 shadow-[0_0_15px_rgba(0,255,65,0.3)]":i?"bg-gradient-to-br from-green-500/20 to-emerald-500/20 border-green-500/50":"hover:border-primary"}`,children:[e.jsxs("div",{className:"relative aspect-video rounded-lg mb-3 overflow-hidden bg-gradient-to-br from-muted to-muted/50 flex items-center justify-center",children:[s.isAnimated&&e.jsxs(g,{className:"absolute top-2 right-2 bg-purple-500",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"Animated"]}),n&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs(g,{className:"bg-matrix-green text-black animate-pulse",children:[e.jsx(f,{className:"w-3 h-3 mr-1"}),"Equipped"]})}),i&&!n&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsxs(g,{className:"bg-green-500",children:[e.jsx(f,{className:"w-3 h-3 mr-1"}),"Owned"]})}),s.category==="background"&&e.jsx("div",{className:"text-4xl",children:"🎨"}),s.category==="nameColor"&&e.jsx("div",{className:"text-2xl font-bold",style:{color:s.itemId.includes("green")?"#00ff00":s.itemId.includes("blue")?"#0088ff":s.itemId.includes("gold")?"#ffd700":"#ff00ff"},children:s.name}),s.category==="badge"&&e.jsx("div",{className:"text-4xl",children:"🏅"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"font-semibold text-base mb-1",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]}),i?e.jsx("div",{className:"space-y-2",children:n?e.jsxs(e.Fragment,{children:[e.jsxs(c,{className:"w-full bg-matrix-green hover:bg-matrix-green/90 text-black",disabled:!0,children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Currently Equipped"]}),e.jsx(c,{variant:"outline",className:"w-full",onClick:()=>w(s.itemId,!0),disabled:p.isPending,children:"Unequip"})]}):e.jsxs(c,{className:"w-full bg-cyber-blue hover:bg-cyber-blue/90",onClick:()=>w(s.itemId,!1),disabled:p.isPending,children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Equip"]})}):e.jsxs("div",{className:"space-y-2",children:[s.priceCs&&e.jsxs(c,{className:"w-full",onClick:()=>x(s),disabled:d.isPending,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),s.priceCs.toLocaleString()," CS"]}),s.priceChst&&!s.priceCs&&e.jsxs(c,{className:"w-full",variant:"outline",onClick:()=>x(s),disabled:d.isPending,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),s.priceChst," CHST"]}),s.priceTon&&!s.priceCs&&!s.priceChst&&e.jsxs(c,{className:"w-full bg-blue-500 hover:bg-blue-600",onClick:()=>x(s),disabled:d.isPending,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),s.priceTon," TON"]})]})]},s.itemId)})}),T.length===0&&e.jsx(u,{className:"p-6",children:e.jsx("p",{className:"text-center text-muted-foreground",children:"No cosmetics available in this category yet."})}),e.jsx(u,{className:"p-4 bg-muted/30",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["💡 ",e.jsx("strong",{children:"Tip:"})," Equip cosmetics to customize your profile! Backgrounds, name colors, and badges will display when other players view your profile."]})})]})})}export{W as default};
