import{j as e}from"./ui-DDb1Cthj.js";import{r as h}from"./vendor-CbTYwD9p.js";import{u as L,a as C}from"./query-DJEuKXE5.js";import{u as te,g as ae,S as P,C as d,a as x,B as H,D as F,b as D,c as E,d as k,e as U,f as B,q as y}from"./index-DP8xWL5x.js";import{I as re}from"./input-CRHmV_Qe.js";import{L as ne}from"./label-DvYd1ndl.js";import{P as Q,Z as z,l as J,H as I,I as V,r as ie,M as $,J as de}from"./icons-DpVlej8W.js";import"./router-i_uqa6-9.js";import"./tonconnect-BAw8c48p.js";import"./ton-BfqU8ldO.js";import"./utils-BkWO3WEY.js";const c=10;function p(t,u,N){if(N==="Basic"||N==="Gaming")return Math.floor(t*Math.pow(1.1,u));if(u>=10){const g=Math.pow(1.05,u-9);return Math.floor(t*g)}else return Math.floor(t*Math.pow(1.1,u))}function Ne(){var R,K;const[t,u]=h.useState(null),[N,g]=h.useState(!1),[Y,v]=h.useState(!1),[j,w]=h.useState(""),[Z,S]=h.useState(!1),[m,_]=h.useState(null),{toast:o}=te(),r=ae(),{data:l=[],isLoading:X}=L({queryKey:["/api/user",r,"equipment"],enabled:!!r}),{data:a}=L({queryKey:["/api/user",r],enabled:!!r}),{data:M=[]}=L({queryKey:["/api/user",r,"equipment","presets"],enabled:!!r}),T=C({mutationFn:async({equipmentTypeId:s})=>(await B("POST",`/api/user/${r}/equipment/upgrade`,{equipmentTypeId:s})).json(),onSuccess:s=>{o({title:"Upgrade Successful!",description:`Level ${s.newLevel} - Hashrate increased by ${s.hashrateIncrease.toFixed(2)} GH/s`}),y.invalidateQueries({queryKey:["/api/user",r,"equipment"]}),y.invalidateQueries({queryKey:["/api/user",r]}),g(!1)},onError:s=>{o({title:"Upgrade Failed",description:s.message,variant:"destructive"})}}),q=C({mutationFn:async s=>(await B("POST",`/api/user/${r}/equipment/presets`,{presetName:s})).json(),onSuccess:s=>{y.invalidateQueries({queryKey:["/api/user",r,"equipment","presets"]}),v(!1),w(""),o({title:"Preset Saved!",description:s.message||"Equipment preset saved successfully"})},onError:s=>{o({title:"Save Failed",description:s.message,variant:"destructive"})}}),W=C({mutationFn:async s=>(await B("DELETE",`/api/user/${r}/equipment/presets/${s}`)).json(),onSuccess:s=>{y.invalidateQueries({queryKey:["/api/user",r,"equipment","presets"]}),o({title:"Preset Deleted",description:s.message||"Preset deleted successfully"})},onError:s=>{o({title:"Delete Failed",description:s.message,variant:"destructive"})}}),ee=s=>{u(s),g(!0)},se=s=>{T.mutate({equipmentTypeId:s})},O=()=>{if(!j.trim()){o({title:"Name Required",description:"Please enter a name for your preset",variant:"destructive"});return}q.mutate(j.trim())},G=l.reduce((s,n)=>s+n.currentHashrate,0),A=l.length>0?l.reduce((s,n)=>s+n.upgradeLevel,0)/l.length:0;return X?e.jsx("div",{className:"min-h-screen bg-background terminal-scanline",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-2 md:p-4 space-y-3 md:space-y-6",children:[e.jsx("div",{className:"hidden md:flex items-center justify-between",children:e.jsx(P,{className:"h-12 w-64"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4",children:[1,2,3,4].map(s=>e.jsx(d,{className:"p-2.5 md:p-4",children:e.jsx(P,{className:"h-20 w-full"})},s))}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:[1,2,3].map(s=>e.jsx(d,{className:"p-3 md:p-4",children:e.jsx(P,{className:"h-48 w-full"})},s))})]})}):e.jsxs("div",{className:"min-h-screen bg-background terminal-scanline",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-3 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(d,{className:"p-2.5 md:p-4","data-testid":"card-total-rigs",children:[e.jsxs("div",{className:"flex items-center gap-1 md:gap-2 mb-1 md:mb-2",children:[e.jsx(Q,{className:"w-3 md:w-4 h-3 md:h-4 text-matrix-green"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground uppercase",children:"Total Rigs"})]}),e.jsx("p",{className:"text-lg md:text-2xl font-bold font-mono","data-testid":"text-total-rigs",children:l.length})]}),e.jsxs(d,{className:"p-2.5 md:p-4","data-testid":"card-total-hashrate",children:[e.jsxs("div",{className:"flex items-center gap-1 md:gap-2 mb-1 md:mb-2",children:[e.jsx(z,{className:"w-3 md:w-4 h-3 md:h-4 text-neon-orange"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground uppercase",children:"Total Hashrate"})]}),e.jsx("p",{className:"text-lg md:text-2xl font-bold font-mono text-matrix-green","data-testid":"text-total-hashrate",children:G.toFixed(2)}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"GH/s"})]}),e.jsxs(d,{className:"p-2.5 md:p-4","data-testid":"card-avg-upgrade",children:[e.jsxs("div",{className:"flex items-center gap-1 md:gap-2 mb-1 md:mb-2",children:[e.jsx(J,{className:"w-3 md:w-4 h-3 md:h-4 text-cyber-blue"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground uppercase",children:"Avg Upgrade"})]}),e.jsx("p",{className:"text-lg md:text-2xl font-bold font-mono","data-testid":"text-avg-upgrade",children:A.toFixed(1)}),e.jsxs("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:["/ ",c,".0"]})]}),e.jsxs(d,{className:"p-2.5 md:p-4","data-testid":"card-cs-balance",children:[e.jsxs("div",{className:"flex items-center gap-1 md:gap-2 mb-1 md:mb-2",children:[e.jsx(z,{className:"w-3 md:w-4 h-3 md:h-4 text-chart-1"}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground uppercase",children:"CS Balance"})]}),e.jsx("p",{className:"text-lg md:text-2xl font-bold font-mono text-cyber-blue","data-testid":"text-cs-balance",children:((R=a==null?void 0:a.csBalance)==null?void 0:R.toLocaleString())??0}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground",children:"CS"})]})]}),e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-cyan-500"}),e.jsx("h3",{className:"font-semibold text-base",children:"Equipment Presets"})]}),e.jsxs(x,{size:"sm",onClick:()=>v(!0),disabled:l.length===0,children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Save Current Setup"]})]}),M.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:M.map(s=>e.jsxs(d,{className:"p-3 hover-elevate transition-all cursor-pointer border-dashed",onClick:()=>{_(s),S(!0)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-sm truncate",children:s.presetName}),e.jsx(x,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:n=>{n.stopPropagation(),confirm(`Delete preset "${s.presetName}"?`)&&W.mutate(s.id)},children:e.jsx(ie,{className:"w-3 h-3 text-destructive"})})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Saved ",new Date(s.createdAt).toLocaleDateString()]}),e.jsxs("p",{className:"text-xs text-matrix-green mt-1",children:[JSON.parse(s.equipmentSnapshot).length," equipment items"]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"w-12 h-12 mx-auto mb-3 text-muted-foreground opacity-30"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No saved presets yet. Save your current equipment setup to quickly reference it later."})]})]}),l.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:l.map(s=>{const n=s.equipmentType.baseHashrate*s.quantity,b=(s.currentHashrate/n-1)*100,i=s.upgradeLevel<c?p(s.equipmentType.basePrice,s.upgradeLevel,s.equipmentType.tier):0;return e.jsxs(d,{className:"p-3 md:p-4 hover-elevate transition-all cursor-pointer",onClick:()=>ee(s),"data-testid":`rig-card-${s.equipmentTypeId}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-matrix-green"}),e.jsx(H,{variant:"outline",className:"text-xs",children:s.equipmentType.tier})]}),e.jsxs(H,{variant:"outline",className:"text-xs","data-testid":`badge-level-${s.equipmentTypeId}`,children:["Level ",s.upgradeLevel]})]}),e.jsx("h4",{className:"font-semibold mb-1","data-testid":`text-name-${s.equipmentTypeId}`,children:s.equipmentType.name}),s.quantity>1&&e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Quantity: ",s.quantity]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Base Hashrate"}),e.jsxs("span",{className:"font-mono","data-testid":`text-base-hashrate-${s.equipmentTypeId}`,children:[n.toFixed(2)," GH/s"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Current Hashrate"}),e.jsxs("span",{className:"font-mono font-semibold text-matrix-green","data-testid":`text-current-hashrate-${s.equipmentTypeId}`,children:[s.currentHashrate.toFixed(2)," GH/s"]})]}),b>0&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Boost"}),e.jsxs("span",{className:"font-mono text-neon-orange","data-testid":`text-boost-${s.equipmentTypeId}`,children:["+",b.toFixed(0),"%"]})]}),s.upgradeLevel<c&&e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Next Upgrade"}),e.jsxs("span",{className:"font-mono","data-testid":`text-upgrade-cost-${s.equipmentTypeId}`,children:[i.toLocaleString()," CS"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Upgrade Progress"}),e.jsxs("span",{className:"font-mono",children:[s.upgradeLevel,"/",c]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-matrix-green rounded-full h-2 transition-all",style:{width:`${s.upgradeLevel/c*100}%`}})})]})]},s.id)})}):e.jsxs(d,{className:"p-12 text-center",children:[e.jsx(Q,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-20"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Rigs Yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Visit the Shop to purchase your first mining rig"}),e.jsx(x,{variant:"default","data-testid":"button-go-to-shop",children:"Go to Shop"})]})]}),e.jsx(F,{open:N,onOpenChange:g,children:e.jsxs(D,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(E,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-matrix-green"}),t==null?void 0:t.equipmentType.name]}),e.jsx(U,{children:"Upgrade your rig to increase its mining performance"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 rounded-md bg-muted/30 border border-border",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Current HR"}),e.jsx("p",{className:"text-lg font-bold font-mono text-matrix-green","data-testid":"text-dialog-current-hashrate",children:t.currentHashrate.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Level"}),e.jsxs("p",{className:"text-lg font-bold font-mono","data-testid":"text-dialog-level",children:[t.upgradeLevel,"/",c]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Boost"}),e.jsxs("p",{className:"text-lg font-bold font-mono text-neon-orange","data-testid":"text-dialog-boost",children:["+",((t.currentHashrate/(t.equipmentType.baseHashrate*t.quantity)-1)*100).toFixed(0),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Quantity"}),e.jsx("p",{className:"text-lg font-bold font-mono","data-testid":"text-dialog-quantity",children:t.quantity})]})]})}),t.upgradeLevel<c?e.jsxs("div",{className:"p-4 rounded-md border bg-card",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wider mb-3",children:"Next Upgrade Available"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Upgrade to Level"}),e.jsx("span",{className:"font-mono font-semibold","data-testid":"text-next-level",children:t.upgradeLevel+1})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Hashrate Increase"}),e.jsxs("span",{className:"font-mono text-matrix-green","data-testid":"text-hashrate-increase",children:["+",(t.equipmentType.baseHashrate*.1*t.quantity).toFixed(2)," GH/s"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Upgrade Cost"}),e.jsxs("span",{className:"font-mono font-semibold","data-testid":"text-dialog-upgrade-cost",children:[p(t.equipmentType.basePrice,t.upgradeLevel,t.equipmentType.tier).toLocaleString()," CS"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Your Balance"}),e.jsxs("span",{className:`font-mono ${((a==null?void 0:a.csBalance)??0)>=p(t.equipmentType.basePrice,t.upgradeLevel,t.equipmentType.tier)?"text-matrix-green":"text-destructive"}`,"data-testid":"text-dialog-balance",children:[((K=a==null?void 0:a.csBalance)==null?void 0:K.toLocaleString())??0," CS"]})]})]}),((a==null?void 0:a.csBalance)??0)<p(t.equipmentType.basePrice,t.upgradeLevel,t.equipmentType.tier)&&e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-md bg-destructive/10 border border-destructive/30 mb-4",children:[e.jsx(de,{className:"w-4 h-4 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-sm text-destructive",children:["Insufficient CS balance. You need"," ",(p(t.equipmentType.basePrice,t.upgradeLevel,t.equipmentType.tier)-((a==null?void 0:a.csBalance)??0)).toLocaleString()," ","more CS to upgrade."]})]}),e.jsx(x,{size:"default",variant:"default",className:"w-full",disabled:T.isPending||((a==null?void 0:a.csBalance)??0)<p(t.equipmentType.basePrice,t.upgradeLevel,t.equipmentType.tier),onClick:()=>se(t.equipmentTypeId),"data-testid":"button-upgrade-confirm",children:T.isPending?"Upgrading...":e.jsxs(e.Fragment,{children:["Upgrade for ",p(t.equipmentType.basePrice,t.upgradeLevel,t.equipmentType.tier).toLocaleString()," CS"]})})]}):e.jsxs("div",{className:"p-6 rounded-md border bg-muted/30 text-center",children:[e.jsx(J,{className:"w-12 h-12 mx-auto mb-3 text-matrix-green"}),e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Maximum Level Reached"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["This equipment is fully upgraded to level ",c]})]})]})]})}),e.jsx(F,{open:Y,onOpenChange:v,children:e.jsxs(D,{children:[e.jsxs(E,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-cyan-500"}),"Save Equipment Preset"]}),e.jsx(U,{children:"Save your current equipment configuration for easy reference"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"preset-name",children:"Preset Name"}),e.jsx(re,{id:"preset-name",placeholder:"e.g., Mining Setup 2024",value:j,onChange:s=>w(s.target.value),maxLength:50,onKeyDown:s=>{s.key==="Enter"&&O()}}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[j.length,"/50 characters"]})]}),e.jsxs("div",{className:"p-3 rounded-md bg-muted/30 border",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Current Equipment Summary"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Total Equipment: ",l.length," items"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Total Hashrate: ",G.toFixed(2)," GH/s"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Average Level: ",A.toFixed(1)]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"outline",className:"flex-1",onClick:()=>{v(!1),w("")},children:"Cancel"}),e.jsx(x,{className:"flex-1",onClick:O,disabled:q.isPending||!j.trim(),children:q.isPending?"Saving...":"Save Preset"})]})]})]})}),e.jsx(F,{open:Z,onOpenChange:S,children:e.jsxs(D,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(E,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-cyan-500"}),m==null?void 0:m.presetName]}),e.jsxs(U,{children:["Saved on ",m&&new Date(m.createdAt).toLocaleString()]})]}),m&&(()=>{const s=JSON.parse(m.equipmentSnapshot),n=s.reduce((i,f)=>i+f.currentHashrate,0),b=s.length>0?s.reduce((i,f)=>i+f.upgradeLevel,0)/s.length:0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-md bg-muted/30 border",children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",children:"Preset Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Equipment"}),e.jsx("p",{className:"text-lg font-bold font-mono",children:s.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Hashrate"}),e.jsx("p",{className:"text-lg font-bold font-mono text-matrix-green",children:n.toFixed(2)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"GH/s"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Avg Level"}),e.jsx("p",{className:"text-lg font-bold font-mono",children:b.toFixed(1)})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Equipment List"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.map((i,f)=>e.jsx(d,{className:"p-3",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($,{className:"w-4 h-4 text-matrix-green"}),e.jsx("h5",{className:"font-semibold text-sm",children:i.equipmentType.name}),e.jsxs(H,{variant:"outline",className:"text-xs",children:["Level ",i.upgradeLevel]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Tier: "}),e.jsx("span",{className:"font-mono",children:i.equipmentType.tier})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity: "}),e.jsx("span",{className:"font-mono",children:i.quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Hashrate: "}),e.jsxs("span",{className:"font-mono text-matrix-green",children:[i.currentHashrate.toFixed(2)," GH/s"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Base Price: "}),e.jsxs("span",{className:"font-mono",children:[i.equipmentType.basePrice.toLocaleString()," CS"]})]})]})]})})},f))})]}),e.jsx(x,{variant:"outline",className:"w-full",onClick:()=>S(!1),children:"Close"})]})})()]})})]})}export{Ne as default};
